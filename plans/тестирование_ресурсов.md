# План тестирования ресурсов

## Цель
Добавить тесты для каждого ресурса (API клиенты и скраперы) с использованием ISBN из `isbn_list.txt`. Тест считается пройденным, если для ресурса успешно возвращается хотя бы один результат.

## Ресурсы для тестирования

### API клиенты (синхронные)
1. `get_from_google_books` (Google Books)
2. `get_from_open_library` (Open Library)
3. `get_from_rsl` (РГБ)

### API клиенты (асинхронные)
1. `get_from_google_books_async`
2. `get_from_open_library_async`
3. `get_from_rsl_async`

### Скраперы (веб-скрапинг)
1. Читай-город (`chitai-gorod`)
2. Book.ru (`book-ru`)

## Структура тестовой директории
```
tests/
├── __init__.py
├── conftest.py
├── test_api_clients_sync.py
├── test_api_clients_async.py
├── test_scrapers.py
└── utils.py
```

## Подход
- Использовать pytest как фреймворк.
- Реальные сетевые запросы (интеграционные тесты).
- Для асинхронных тестов использовать `pytest-asyncio`.
- Чтение ISBN из `isbn_list.txt` (предполагается, что файл находится в корне проекта).
- Тест для каждого ресурса должен перебирать ISBN до первого успешного результата.
- Если ни один ISBN не дал результат, тест помечается как skipped с соответствующим сообщением.
- Тесты должны быть устойчивы к временным сбоям сети (таймауты, ошибки HTTP).

## Зависимости
Убедиться, что установлены:
- pytest
- pytest-asyncio
- requests
- aiohttp
- beautifulsoup4
- selenium (для скраперов)

## Детали реализации

### 1. `conftest.py`
- Фикстура для чтения списка ISBN.
- Фикстура для создания aiohttp сессии.
- Фикстура для конфигурации скрапера.

### 2. `test_api_clients_sync.py`
- Тесты для синхронных функций.
- Параметризованный тест по ресурсам.
- Внутри теста цикл по ISBN, вызов функции, проверка что результат не None.
- Если хотя бы один ISBN вернул данные, тест проходит.

### 3. `test_api_clients_async.py`
- Асинхронные тесты с `pytest.mark.asyncio`.
- Аналогичная логика.

### 4. `test_scrapers.py`
- Тесты для скраперов требуют запуска браузера (Selenium).
- Использовать фикстуру драйвера из `drivers.py`.
- Для каждого ресурса выполнить поиск по ISBN, перейти на страницу товара, распарсить данные.
- Учитывать возможные модальные окна (например, выбор города).
- Тест проходит, если хотя бы для одного ISBN получены заголовок и автор.

### 5. `utils.py`
- Вспомогательные функции: загрузка ISBN, нормализация, повторные попытки.

## Критерии успеха
- Все тесты проходят (или skipped, если ресурс недоступен).
- Покрытие всех ресурсов.
- Чёткие сообщения об ошибках.

## Следующие шаги
1. Создать директорию `tests/` и файлы.
2. Написать фикстуры в `conftest.py`.
3. Реализовать тесты для синхронных API клиентов.
4. Реализовать тесты для асинхронных API клиентов.
5. Реализовать тесты для скраперов.
6. Запустить тесты и убедиться в их работоспособности.
7. При необходимости добавить обработку ошибок и логирование.

## Примечания
- Тесты могут быть медленными из-за сетевых запросов и использования браузера.
- Рекомендуется запускать тесты в фоновом режиме или в CI.
- Возможно, потребуется прокси или увеличение таймаутов для некоторых ресурсов.