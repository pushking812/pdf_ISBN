# План оптимизации отладочного вывода

## Проблемы, выявленные при анализе

### 1. Безымянные константы
- В функции `build_xpath_text_condition` в `debug_selectors.py` используются длинные строки с алфавитами:
  - `'ABCDEFGHIJKLMNOPQRSTUVWXYZАБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ'`
  - `'abcdefghijklmnopqrstuvwxyzабвгдеёжзийклмнопрстуфхцчшщъыьэюя'`
- Эти строки повторяются в нескольких местах и забивают вывод консоли

### 2. Избыточный вывод HTML
- Функция `print_fragments` выводит полные HTML фрагменты без ограничений
- При больших фрагментах вывод становится нечитаемым

### 3. Множественные отладочные сообщения
- В режиме `verbose=True` выводится слишком много деталей
- Некоторые сообщения дублируют информацию
- Отсутствует структурированное логирование

### 4. Длинные XPath выражения
- Сгенерированные XPath содержат полные алфавиты для case-insensitive поиска
- Вывод паттернов занимает много места в консоли

## Предлагаемые решения

### Этап 1: Создание именованных констант
```python
# Добавить в начало debug_selectors.py
ENGLISH_UPPERCASE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
ENGLISH_LOWERCASE = 'abcdefghijklmnopqrstuvwxyz'
RUSSIAN_UPPERCASE = 'АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ'
RUSSIAN_LOWERCASE = 'абвгдеёжзийклмнопрстуфхцчшщъыьэюя'
```

### Этап 2: Ограничение вывода HTML
- Модифицировать `print_fragments` для ограничения длины HTML
- Добавить параметр `max_length` (по умолчанию 500 символов)
- Показывать `[HTML обрезан, длина: X символов]` при превышении
- Добавить опцию командной строки `--max-html-length`

### Этап 3: Система логирования
- Создать функцию-помощник для структурированного логирования
- Ввести уровни: ERROR, WARN, INFO, DEBUG
- Заменить прямые вызовы `print()` на функцию логирования
- Группировать похожие сообщения

### Этап 4: Компактизация XPath вывода
- Добавить функцию для сокращения длинных XPath в отладочном выводе
- Показывать только тип селектора и ключевые части
- Сохранять полный вывод для файлов логов

### Этап 5: Новые параметры командной строки
- `--log-level`: Уровень детализации (error, warn, info, debug)
- `--max-html-length`: Максимальная длина выводимого HTML
- `--compact-output`: Компактный режим вывода
- `--output-file`: Сохранение полного вывода в файл

## Ожидаемые результаты

1. **Уменьшение объема вывода**: На 60-80% за счет компактизации
2. **Улучшение читаемости**: Структурированный вывод с уровнями важности
3. **Гибкость настройки**: Возможность тонкой настройки уровня детализации
4. **Сохранение функциональности**: Полный вывод доступен при необходимости

## Приоритеты реализации

1. Высокий: Замена безымянных констант
2. Высокий: Ограничение вывода HTML
3. Средний: Система логирования
4. Низкий: Компактизация XPath

## Оценка сложности
- Время реализации: 2-4 часа
- Риски: Низкие (изменения в основном касаются вывода, не логики)
- Тестирование: Требуется проверка всех режимов работы

## Следующие шаги
1. Получить одобрение плана от пользователя
2. Перейти в режим Code для реализации
3. Поэтапная реализация с тестированием после каждого этапа
4. Документирование изменений в PROGRESS.md