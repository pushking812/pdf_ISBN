# AGENTS.md

## ИСКЛЮЧЕННЫЕ ИЗ КОНТЕКСТА РАССМОТРЕНИЯ ПАПКИ И ФАЙЛЫ
  venv/, .vscode/, .venv/, .qodo, env/, bin/, lib/, share/, include/, __pycache__/, *.pyc, *.pyo, *.pyd, LICENSE, .pytest_cache, .qodo, .ruff_cache, .git/, .idea/, dist/, build/, *.egg-info/

## ПРАВИЛА РАБОТЫ (ЭКОНОМИЯ И КАЧЕСТВО)
  - **Точность и полнота формулировок:**
    Если поставленная задача пользователем не ясна, не полна или некорректна — задавай уточняющие вопросы и предлагай на выбор варианты решения.

  - **Разбиение на подзадачи:**
    Если поставленная задача сложна и требует большого контекстного объема, разбей ее логически на более мелкие, которые сведут вероятность ошибок к минимуму.

  - **Минимализм и качество кода:**
    Всегда стремись к минимальному количеству изменений, необходимых для решения задачи, сохраняя при этом читаемость и соответствие стилю проекта. **Если решение требует дублирования кода, предложи рефакторинг (вынесение в функцию/класс) с минимальными изменениями структуры.**

  - **Язык общения и комментариев в коде:**
    Всегда используй **русский язык** для комментариев в коде, сообщений в терминале и описания изменений.

  - **Проверка перед действием:**
    Перед созданием новых файлов или рефакторингом всегда проверяй в режиме PLAN/Architect, нет ли уже готового решения в проекте. **Начинай анализ с беглого просмотра `CONCEPTION.md` (если есть), чтобы понять архитектуру.**

  - **Python-стиль:**
    Используй аннотации типов (Type Hinting) и следуй PEP 8. **Для новых функций/классов добавляй докстринги (рекомендуется стиль Google или Sphinx). После внесения изменений рекомендуется запускать `ruff format` для автоматического форматирования кода.**

  - **Запрет на чтение больших файлов:**
    Не читай файлы размером > **2KB** без моего одобрения. Исключение: быстрая проверка шапки файла (первые 10-15 строк) для анализа импортов или структуры конфигурации.

  - **Терминал:**
    Сначала проверяй наличие зависимостей (`pip list`), прежде чем пытаться их устанавливать. **Если добавляешь новую библиотеку, предложи добавить её в `requirements.txt` или `pyproject.toml` (в зависимости от проекта).**

  - **Архитектура:**
    Если задача требует изменения более 3 файлов, сначала опиши архитектурную схему в чате.

  - **Режим планирования (Plan/Architect):**
    Всегда начинай более-менее сложные задачи в режиме Plan/Architect.
    Сначала проанализируй структуру, опиши шаги и получи "Approve" пользователя, прежде чем переходить в режим Act/Code.

  - **Принцип DIFF и целостность функций:**
    Для файлов длиннее 200 строк используй инструменты частичной замены (`replace_lines` или `patch`) вместо перезаписи всего файла.
    Никогда не присылай "огрызки" кода с комментариями "# ... остальной код". Заменяемый блок должен содержать измененную функцию, метод или класс ПОЛНОСТЬЮ, чтобы сохранить синтаксическую целостность.

## СТРАТЕГИЯ ИСПОЛЬЗОВАНИЯ УТИЛИТ КОМАНДНОЙ СТРОКИ И POWERSHELL
  - **Терминал vs Чтение:**
    Если задачу можно решить через CLI (проверить наличие файла, версию библиотеки, список папок, найти положение элемента в коде) — всегда выбирай терминал. Это быстрее и дешевле, чем анализировать код глазами.

  - **Вывод логов в файл:**
    Ограничивай многострочный вывод в консоль, лучше выводи во временный файл и находи нужные строки командами поиска текста.

  - **Ошибки при выполнении команд:**
    Если при выполнении команда выдала ошибку, либо не выдала ожидаемого результата - проанализировать вывод и откорректировать команду, либо использовать альтернативную. При нескольких последовательных неудачах - остановится, запросить разрешение продолжить у пользователя. 

  - **Работа с терминалом:**
    Если команда завершилась с ошибкой, не пытайся угадать исправление — сначала прочитай последние 20 строк лога ошибки, проанализируй их и только потом предлагай решение. **Не выводи в чат содержимое логов, если там могут быть пароли или ключи API. Сообщи о наличии ошибки и предложи способ её исправления.**

  - **Среда разработки:**
    Разработка кода осуществляется в среде Windows. Предпочитай использование PowerShell вместо bash-команд.
    **Полезные команды PowerShell:**
    *   **Просмотр структуры:** `Get-ChildItem -Recurse -Depth 2 -Directory | Select-Object FullName` (папки) или `Get-ChildItem -Recurse -Depth 2 -File | Select-Object FullName` (файлы).
    *   **Чтение начала/конца файла:** `Get-Content ".\file.py" -TotalCount 15` (первые 15 строк), `Get-Content ".\file.py" -Tail 20` (последние 20 строк).
    *   **Поиск в файлах:** `Select-String -Path '.\**\*.py' -Pattern 'искомый_текст'` . **Используй `-List` чтобы выводить только имена файлов, если нужно просто найти, где встречается паттерн.**
    *   **Удаление:** `Remove-Item -Force -Recurse ".\path\to\folder"` .
    *   **Добавление строки в файл:** `Add-Content -Path ".\PROGRESS.md" -Value "[date] - message"`.
    
   - **Поиск в коде:**
     Вместо команд Git Bash head, tail, и т.п. - используй команды аналоги из PowerShell, например: 'Get-Content "файл" -Head 30', 'Get-Content "файл" -Tail 20', 'Get-Content "файл" -Wait'.

  - **Перед началом любой задачи (Discovery):**
    Для получения общей структуры проекта сначала запусти `Get-ChildItem -Recurse -Depth 1 -Directory` или `tree /F /A` (если доступно). Используй исключения (`-Exclude`), чтобы не выводить мусор.

  - **При поиске определений или связей (Search):**
    Если нужно найти, где используется элемент кода — используй `Select-String -Path '.\**\*.py' -Pattern 'ЗНАЧЕНИЕ'`(или findstr /S /I "ЗНАЧЕНИЕ" *.py). Чтение файла через `read_file` разрешено только ПОСЛЕ того, как ты нашел нужную строку через поиск.

  - **Верификация кода после произведенных корректировок:**
    После каждой правки в Python-файлах автоматически запускай `ruff check .` . Если найдены ошибки — исправляй их немедленно, не завершая задачу. **После исправления ошибок линтинга рекомендуется запустить `ruff format` для единообразия кода.**

  - **При работе с импортами (Imports):**
    Если возникла `ImportError`, используй `Get-Content -Path 'file.py' -TotalCount 20`, чтобы быстро проверить блок импортов, не выкачивая весь файл в контекст.

## ВЕДЕНИЕ ДОКУМЕНТАЦИИ (CONCEPTION & PROGRESS)
  - **CONCEPTION.md (Архитектура):**
    Это "священный грааль" проекта. **В начале работы над задачей, если `CONCEPTION.md` существует, бегло ознакомься с ним, чтобы не нарушить архитектуру.**
    Если в ходе задачи меняется архитектура (новые модули, смена БД, логика связей), ОБЯЗАТЕЛЬНО обнови этот файл в конце задачи. Пиши кратко и по существу.

  - **PROGRESS.md (Лог изменений):**
    После завершения каждой подзадачи или исправления бага, добавь запись в конец файла.
    **Формат:** `[ГГГГ-ММ-ДД ЧЧ:ММ] - [Краткое описание изменений] (файлы: файл1.py, файл2.py)`. **Нумерация задач необязательна, но приветствуется, если пользователь её ведёт.**
    *ВАЖНО:* Не анализируй всё содержимое этого файла перед записью. Просто дописывай (append) новую строку в конец, используя `Add-Content` в PowerShell.

  - **Алгоритм завершения задачи (Task):**
    1.  Убедись, что код проходит проверку `ruff check` (и опционально `ruff format`).
    2.  Проверь, нужно ли обновить `CONCEPTION.md`.
    3.  Сделай запись в `PROGRESS.md`.
    4.  Обнаруженные но не исправленные проблемы вносить в TODO.md. Удалять из TODO.md неактуальные записи.
        Поддерживать существующий принцип орагниации файла TODO.md.
    5.  Только после этого отчитайся пользователю о выполнении, кратко резюмируя, что было сделано.